<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="account_invoice_l10n_hr_form" model="ir.ui.view">
        <field name="name">account_invoice_l10n_hr_form</field>
        <field name="model">account.invoice</field>
        <field name="type">form</field>
        <field name="inherit_id" ref="account.invoice_form"/>
        <field name="arch" type="xml">
            <!-- remove wrong cancel button -->
<!--                <button name="action_invoice_cancel" position="attributes">-->
<!--                    <attribute name="invisible">[('croatia','=',True)]</attribute>-->
<!--                </button>-->
            <xpath expr="//form/sheet//label[@for='currency_id']/following::div[1]" position="after">
                <field name="fiskal_responsible_id" create="0" delete="0" colspan="2"/>
                <field name="fiskal_user_id" create="0" delete="0" colspan="2"/>
            </xpath>
            <field name="date_invoice" position="before">
                <field name="date_document" force_save="1"/>
                <field name="date_delivery"/>
            </field>
            <field name="date_invoice" position="replace">
                <label for="date_invoice" />
                <div>
                    <field name="date_invoice" options="{'datepicker': {'warn_future': true}}" class="oe_inline"/>
                    <span>&amp;nbsp;&amp;nbsp;&amp;nbsp;</span>
                    <label for="vrijeme_izdavanja" attrs="{'invisible': [('vrijeme_izdavanja', '=', False)]}"
                           style="font-weight:bold;"/>
                    <field name="vrijeme_izdavanja" class="oe_inline" readonly="1"/>
                </div>
            </field>
            <xpath expr="//field[@name='number']/.." position="before">
                <div attrs="{'invisible': ['|',('fiskalni_broj','=',False),('croatia','=',False)]}">
                    <label for="fiskalni_broj"  string="HR fiskal number : " />
                    <field name="fiskalni_broj"  class="oe_inline" readonly="1"/>
<!--                        <label string=" - internal number - " class="oe_inline"/>-->
                </div>
            </xpath>

            <!--Using a more specific xpath because using a simple field name invisible will go through
                all view definitions in the inherited view as well as inline view definition and make
                the name field invisible that is not the desired outcome.-->
            <xpath expr="//page[@name='other_info']//field[@name='name']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>

            <xpath expr="//page[@name='other_info']/group/group[last()]" position="after">
                <group string="Croatia data" name="croatia"
                      attrs="{'invisible':[('croatia','=',False)]}" colspan="4" col="4">
                    <field name="fiskal_uredjaj_id" widget="selection"
                       attrs="{'required':[('type','in',['out_invoice','out_refund']),('croatia','=',True)],
                               'invisible':[('croatia','=',False)]}"/>
                    <field name="nacin_placanja"
                       attrs="{'required':[('type','in',['out_invoice','out_refund'])],
                               'invisible':[('croatia','=',False)]}"/>
                    <!--<field name="date_document" /> &lt;!&ndash; do i need it? &ndash;&gt;-->
                    <!--<field name="fiskalni_broj" readonly="1"/>-->
                </group>
                <field name="croatia" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='tax_line_ids']/tree/field[@name='amount_total']" position="before">
                <field name="base"/>
            </xpath>
        </field>
    </record>

    <record id="account_invoice_supplier_l10n_hr_form" model="ir.ui.view">
        <field name="name">account_invoice_supplier_l10n_hr_form</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_supplier_form"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='number']" position="before">
                <div attrs="{'invisible': [('croatia','=',False)]}">
                    <label for="fiskalni_broj" string="UR-A Račun br.: "/>
                    <field name="fiskalni_broj" class="oe_inline"
                           attrs="{'required': [('state', '=', 'draft'),('croatia','=',True)]}"/>
                </div>
            </xpath>

            <field name="name" position="attributes">
                <attribute name="invisible">True</attribute>
            </field>

            <field name="date_invoice" position="before">
                <field name="date_document" force_save="1"/>
                <field name="croatia" invisible="1"/>
            </field>
            <field name="payment_term_id" position="replace">-->
                <!-- removed: attrs="{'invisible': [('payment_term_id','=',False)]}" -->
                <field name="payment_term_id" options="{'no_create': True}"/>
                <!--DB: this may belog somwehere else one day... -->
            </field>
            <xpath expr="//field[@name='tax_line_ids']/tree/field[@name='amount_total']" position="before">
                <field name="base"/>
            </xpath>
        </field>
    </record>

    <record id="account_invoice_supplier_l10n_hr_tree" model="ir.ui.view">
        <field name="name">account_invoice_supplier_l10n_hr_tree</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_supplier_tree"/>
        <field name="arch" type="xml">
            <field name="number" position="after">
                <field name="fiskalni_broj"/>
            </field>
        </field>
    </record>

</odoo>
